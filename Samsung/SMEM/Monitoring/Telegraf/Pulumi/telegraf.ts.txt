import { Component } from "../../../dependencies/component";

class createUserdata extends Component {

    // defines if this module is internal only
    isInternal = true;;
    
    /**
     * Installs niffler/telegraf.
     */
    createInstallation = (sService, version='1.17.3', arch='amd64') => {
        // in javascript, bacticks is like EOF in other languages.
        return `
cd /tmp/
aws s3 cp s3://smem-base-installers/telegraf/telegraf_${version}-1_${arch}.deb .
dpkg -i telegraf_${version}-1_${arch}.deb

#Install and start the Telegraf service
apt-get install -y telegraf
systemctl start telegraf

#Configure Telegraf

rm -rf /etc/telegraf/telegraf.conf
cd /etc/telegraf
aws s3 sync s3://smem-base-installers/niffler/${sService}/ .
chmod 744 /etc/telegraf/envs.sh
bash /etc/telegraf/envs.sh

#Restart Telegraf service
systemctl restart telegraf
`;
    }

    Create = () => {
        // All userdata should have the .data function. In the future, we will support dynamic and exclusion to state.
        return {
            data: this.createInstallation
        }
    }
}

export default createUserdata;


